---
title: "R Notebook"
output: html_notebook
---

This is the code to transform an image into a Lab csv for further analysis. 
It only works for 24bit images.

```{r}
## Load up packages I'm going to use first.
library(imager) 
library(data.table)

#from Local Computer
#file <- system.file('extdata/lulo1.bmp',package='imager')
#image <- load.image(file)

#C:\Users\usuario\Desktop\Work\Research\Papers\0_RipenessFreshnessAnaMaria\Frescura_frutas\Lulo\24bitBMP
image <- load.image('C:/Users/usuario/Desktop/Work/Research/Papers/0_RipenessFreshnessAnaMaria/Frescura_frutas/Guayaba/24bitBMP/P3E5Guayaba.bmp')
#dim(image)
plot(image)

image.lab <- RGBtoLab(image) #solo funciona para imagenes de 24 bit

#chan <- channels(image.lab) #Extract the channels as a list of images
#names(chan) <- c("L","a","b")

#print(chan[[1]])  # Luminance Channel
#print(chan[[2]])  # a channel
#print(chan[[3]])  # b channel

l <- data.table(image.lab[,,1,1])

#DTP = data.table(  x=numeric(), y=numeric() ,L=numeric() , a=numeric() , b=numeric() )
DTP = data.table(  L=numeric() , a=numeric() , b=numeric() )
for(i in 1:nrow(l))
{
  for(j in 1:ncol(l))
  {
    #DT2 = data.table(x=i,y=j,L=image.lab[i,j,,1],a=image.lab[i,j,,2],b=image.lab[i,j,,3])
    DT2 = data.table(L=image.lab[i,j,,1],a=image.lab[i,j,,2],b=image.lab[i,j,,3])
    DTP <- rbindlist(list(DTP, DT2)) #adding row info to DT
  }
}

write.csv2(DTP, file = "C:/Users/usuario/Desktop/Work/Research/Papers/0_RipenessFreshnessAnaMaria/Frescura_frutas/Guayaba/24bitBMP/P3E5Guayaba.csv",row.names = FALSE)

```
```

